<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferramentas do Produtor</title>

<style>
    :root {
        --primary: #2e8b57;
        --primary-dark: #246b44;
        --background: #f4f6f4;
        --card-bg: #ffffff;
        --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0;
        background: var(--background);
        font-family: "Segoe UI", Arial, sans-serif;
        color: #333;
    }

    header {
        background: var(--primary);
        color: white;
        padding: 30px 20px;
        text-align: center;
        border-bottom-left-radius: var(--radius);
        border-bottom-right-radius: var(--radius);
        box-shadow: 0 4px 10px #0003;
    }

    header img {
        height: 90px;
        margin-bottom: 10px;
    }

    .container {
        width: 94%;
        max-width: 900px;
        margin: 25px auto;
        background: var(--card-bg);
        padding: 25px;
        border-radius: var(--radius);
        box-shadow: 0 3px 12px #0002;
        animation: fadeIn .3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    h2 {
        color: var(--primary);
        text-align: center;
        margin-bottom: 20px;
        font-size: 26px;
    }

    /* BOT√ïES GRANDES COM √çCONES */
    .big-btn {
        width: 100%;
        background: var(--primary);
        color: white;
        padding: 20px;
        border: none;
        border-radius: var(--radius);
        font-size: 22px;
        margin-top: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        transition: .2s;
    }

    .big-btn:hover { background: var(--primary-dark); transform: scale(1.02); }

    .icon {
        font-size: 32px;
    }

    input {
        width: 100%;
        padding: 16px;
        margin-top: 12px;
        font-size: 18px;
        border-radius: var(--radius);
        border: 1px solid #bbb;
    }

    video {
        width: 100%;
        border-radius: var(--radius);
        margin-top: 15px;
        background: #000;
    }

    .mensagem {
        margin-top: 18px;
        padding: 18px;
        border-radius: var(--radius);
        font-weight: bold;
        font-size: 17px;
    }

    .success { background: #d8ffe1; color: #1d6b34; }
    .error   { background: #ffe0e0; color: #7e0000; }

    #loading {
        display: none;
        margin-top: 15px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        color: var(--primary-dark);
    }

    /* Telas */
    .tela { display: none; }
    .ativa { display: block; }
</style>

</head>
<body>

<header>
    <span style="font-size:70px;">üêê</span>
    <h1>Ferramentas do Produtor</h1>
</header>

<!-- ‚ñë‚ñë‚ñë TELA INICIAL ‚ñë‚ñë‚ñë -->
<div id="inicio" class="container tela ativa">
    <h2>Escolha uma op√ß√£o</h2>

    <button class="big-btn" onclick="abrirTela('foto')">
        <span class="icon">üì∑</span> Identifica√ß√£o pela Foto
    </button>

    <button class="big-btn" onclick="abrirTela('torax')">
        <span class="icon">üìè</span> Estimativa pelo T√≥rax
    </button>
</div>

<!-- ‚ñë‚ñë‚ñë TELA DA FOTO ‚ñë‚ñë‚ñë -->
<div id="foto" class="container tela">
    <h2>Identifica√ß√£o pela Foto</h2>

    <video id="video" playsinline autoplay></video>

    <button class="big-btn" onclick="tirarFoto()">
        <span class="icon">üì∏</span> Tirar Foto
    </button>

    <canvas id="canvas" style="display:none;"></canvas>

    <div id="loading">‚è≥ Analisando foto...</div>

    <div id="resultadoFoto"></div>

    <button class="big-btn" onclick="abrirTela('inicio')">‚¨Ö Voltar</button>
</div>

<!-- ‚ñë‚ñë‚ñë TELA DO T√ìRAX ‚ñë‚ñë‚ñë -->
<div id="torax" class="container tela">
    <h2>Estimativa pelo T√≥rax</h2>

    <label>Medi√ß√£o do T√≥rax (cm):</label>
    <input id="inputTorax" type="number" placeholder="Ex: 75">

    <button class="big-btn" onclick="calcular()">
        <span class="icon">üìè</span> Calcular
    </button>

    <div id="resultadoTorax"></div>

    <button class="big-btn" onclick="abrirTela('inicio')">‚¨Ö Voltar</button>
</div>

<script>
/* TROCAR TELAS */
function abrirTela(id) {
    document.querySelectorAll(".tela").forEach(t => t.classList.remove("ativa"));
    document.getElementById(id).classList.add("ativa");

    if (id === "foto") iniciarCamera();
}

/* C√ÇMERA */
let stream;

function iniciarCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => {
            stream = s;
            document.getElementById("video").srcObject = s;
        })
        .catch(() => {
            mostrarMsg("resultadoFoto", "Erro ao acessar c√¢mera.", true);
        });
}

/* FOTO ‚Üí API */
function tirarFoto() {
    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    let loading = document.getElementById("loading");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    let base64full = canvas.toDataURL("image/jpeg");
    let base64clean = base64full.replace("data:image/jpeg;base64,", "");

    loading.style.display = "block";
    mostrarMsg("resultadoFoto", "");

    fetch("https://0h8r4swvyc.execute-api.us-east-1.amazonaws.com/prd/", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ base64: base64clean })
    })
    .then(r => r.json())
    .then(data => {
        loading.style.display = "none";
        mostrarMsg("resultadoFoto", data.body || "An√°lise conclu√≠da!", false);
    })
    .catch(() => {
        loading.style.display = "none";
        mostrarMsg("resultadoFoto", "Erro ao enviar a foto.", true);
    });
}

/* C√ÅLCULO */
function calcular() {
    let torax = parseFloat(document.getElementById("inputTorax").value);

    if (!torax || torax <= 0) {
        mostrarMsg("resultadoTorax", "Digite um valor v√°lido!", true);
        return;
    }

    let peso = (torax**3) / 10500;
    let carcaca = peso * 0.48;
    let carne = carcaca * 0.70;
    let gordura = carcaca * 0.08;

    mostrarMsg("resultadoTorax",
        `Peso estimado: <b>${peso.toFixed(1)} kg</b><br>
         Carca√ßa: <b>${carcaca.toFixed(1)} kg</b><br>
         Carne: <b>${carne.toFixed(1)} kg</b><br>
         Gordura: <b>${gordura.toFixed(1)} kg</b>`,
         false
    );
}

/* MENSAGENS */
function mostrarMsg(id, txt, erro=false) {
    let div = document.getElementById(id);
    div.className = erro ? "mensagem error" : "mensagem success";
    div.innerHTML = txt;
}
</script>

</body>
</html>
